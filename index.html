<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üïµÔ∏è Ca√ßador PRO v4.4 | Biotchelly</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;800&display=swap"
        rel="stylesheet">

    <style>
        /* --- CORE STYLES (DARK DEFAULT) --- */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            /* Slate 900 */
            background-image: radial-gradient(circle at 50% 50%, #1e293b 1px, transparent 1px);
            background-size: 24px 24px;
            transition: background-color 0.3s, color 0.3s;
        }

        .mono {
            font-family: 'JetBrains Mono', monospace;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #0f172a;
        }

        ::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #475569;
        }

        /* Toggle Switch Customization */
        .toggle-checkbox:checked {
            right: 0;
            border-color: #10b981;
        }

        .toggle-checkbox:checked+.toggle-label {
            background-color: #10b981;
        }

        /* Section Header Style */
        .section-title {
            @apply text-sm uppercase font-bold text-emerald-400 mb-4 flex items-center gap-2 border-b border-slate-700 pb-2;
        }

        /* Input Style Base */
        .input-dark {
            @apply w-full bg-slate-900 border border-slate-700 rounded p-3 text-white placeholder-slate-600 focus:border-purple-500 focus:ring-1 focus:ring-purple-500 focus:outline-none transition text-sm;
        }

        /* Checkbox Style Base */
        .checkbox-dark {
            @apply w-4 h-4 text-purple-600 bg-slate-700 border-slate-600 rounded focus:ring-purple-600 focus:ring-2;
        }

        /* Result Card Animation */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-card {
            animation: slideIn 0.5s ease-out forwards;
        }

        /* --- ‚òÄÔ∏è LIGHT MODE OVERRIDES --- */
        html.light-mode body {
            background-color: #f8fafc;
            /* Slate 50 */
            background-image: radial-gradient(circle at 50% 50%, #cbd5e1 1px, transparent 1px);
            color: #334155;
            /* Slate 700 */
        }

        /* Backgrounds & Cards */
        html.light-mode .bg-slate-800,
        html.light-mode .bg-slate-800\/50,
        html.light-mode .bg-black {
            background-color: #ffffff !important;
            border-color: #e2e8f0 !important;
            /* Slate 200 */
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05);
        }

        html.light-mode .bg-slate-900\/30 {
            background-color: #f1f5f9 !important;
            /* Slate 100 */
            border-color: #e2e8f0 !important;
        }

        /* Inputs */
        html.light-mode .input-dark,
        html.light-mode select.input-dark {
            background-color: #f8fafc !important;
            border-color: #cbd5e1 !important;
            color: #0f172a !important;
            placeholder-color: #94a3b8;
        }

        /* Text Colors */
        html.light-mode .text-white {
            color: #0f172a !important;
        }

        /* Slate 900 */
        html.light-mode .text-slate-300 {
            color: #334155 !important;
        }

        /* Slate 700 */
        html.light-mode .text-slate-400 {
            color: #475569 !important;
        }

        /* Slate 600 */
        html.light-mode .text-slate-500 {
            color: #64748b !important;
        }

        /* Slate 500 */

        /* Borders */
        html.light-mode .border-slate-700 {
            border-color: #e2e8f0 !important;
        }

        /* Checkboxes in Light Mode */
        html.light-mode .checkbox-dark {
            background-color: #ffffff;
            border-color: #cbd5e1;
        }

        /* Scrollbar Light */
        html.light-mode ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        html.light-mode ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
        }

        html.light-mode ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>

<body class="text-slate-300 antialiased min-h-screen p-4 md:p-8 transition-colors duration-300">

    <!-- ‚öôÔ∏è CONFIG MODAL -->
    <div id="configModal"
        class="hidden fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center backdrop-blur-sm transition-all">
        <div class="bg-slate-800 p-8 rounded-xl border border-slate-600 w-full max-w-md shadow-2xl relative">
            <h2 class="text-2xl font-bold text-white mb-4"><i class="fa-solid fa-cogs text-purple-400"></i>
                Configura√ß√µes do Sistema</h2>
            <div class="space-y-4">

                <div class="pb-4 border-b border-slate-700">
                    <label class="block text-xs uppercase font-bold text-emerald-400 mb-1">API Token (Casa dos
                        Dados)</label>
                    <input type="text" id="apiTokenCasaDados" placeholder="Cole seu token aqui para trocar de conta"
                        class="input-dark border-emerald-500/50 focus:border-emerald-400">
                    <p class="text-[10px] text-slate-500 mt-1">Este token ser√° enviado ao Kestra em cada requisi√ß√£o.</p>
                </div>

                <div>
                    <label class="block text-xs uppercase font-bold text-slate-500 mb-1">URL do Kestra</label>
                    <input type="text" id="kestraUrl" class="input-dark">
                </div>
                <div>
                    <label class="block text-xs uppercase font-bold text-slate-500 mb-1">Namespace</label>
                    <input type="text" id="kestraNamespace" value="biotchellymcp" class="input-dark">
                </div>
                <div>
                    <label class="block text-xs uppercase font-bold text-slate-500 mb-1">Flow ID</label>
                    <input type="text" id="kestraFlowId" value="06cacador_de_leads" class="input-dark">
                </div>
            </div>
            <div class="mt-8 flex justify-end gap-3">
                <button onclick="toggleConfig()"
                    class="px-4 py-2 text-slate-400 hover:text-white font-bold transition">Cancelar</button>
                <button onclick="saveConfig()"
                    class="px-6 py-2 bg-purple-600 hover:bg-purple-500 text-white rounded font-bold shadow-lg shadow-purple-500/20 transition">Salvar</button>
            </div>
        </div>
    </div>

    <!-- MAIN CONTAINER -->
    <main class="w-full max-w-7xl mx-auto space-y-6">

        <!-- HEADER -->
        <div class="flex flex-col md:flex-row items-center justify-between gap-4 mb-8">
            <div class="flex items-center gap-4">
                <div
                    class="w-16 h-16 flex items-center justify-center bg-slate-800 rounded-2xl border border-slate-700 shadow-lg">
                    <i class="fa-solid fa-filter-circle-dollar text-emerald-400 text-3xl"></i>
                </div>
                <div>
                    <h1 class="text-3xl font-extrabold text-white tracking-tight">CA√áADOR PRO <span
                            class="text-emerald-400">V4.4</span></h1>
                    <p class="text-slate-500 text-sm font-medium mono">INTEGRA√á√ÉO: CASA DOS DADOS EXTENDED + WEBHOOKS
                    </p>
                </div>
            </div>

            <!-- TOOLBAR -->
            <div class="flex gap-3">
                <!-- Theme Toggle Button -->
                <button onclick="toggleTheme()" id="themeBtn"
                    class="px-4 py-2 bg-slate-800 hover:bg-slate-700 border border-slate-700 text-yellow-400 rounded-lg transition shadow-md">
                    <i class="fa-solid fa-sun"></i>
                </button>

                <button onclick="clearForm()"
                    class="px-4 py-2 bg-slate-800 hover:bg-red-900/30 text-red-400 border border-slate-700 rounded-lg transition text-sm font-bold shadow-md">
                    <i class="fa-solid fa-trash mr-2"></i>LIMPAR
                </button>
                <button onclick="toggleConfig()"
                    class="px-4 py-2 bg-slate-800 hover:bg-slate-700 border border-slate-700 text-slate-300 rounded-lg transition shadow-md">
                    <i class="fa-solid fa-gear"></i>
                </button>
            </div>
        </div>

        <form id="hunterForm" onsubmit="event.preventDefault(); startHunt();" class="space-y-6">

            <!-- 1. BUSCA INTELIGENTE -->
            <div class="bg-slate-800/50 border border-slate-700 rounded-xl p-6 backdrop-blur-sm shadow-sm">
                <h3 class="section-title"><i class="fa-solid fa-magnifying-glass"></i> Par√¢metros de Busca</h3>

                <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
                    <!-- Termo Principal -->
                    <div class="md:col-span-8">
                        <label class="block text-xs uppercase font-bold text-slate-400 mb-1">Termo / Raz√£o / Fantasia /
                            S√≥cio</label>
                        <input type="text" id="termo" placeholder="Digite o nome, termo ou CPF/CNPJ do s√≥cio..."
                            class="input-dark text-lg">
                        <div class="flex gap-4 mt-3 text-sm">
                            <label class="flex items-center gap-2 cursor-pointer"><input type="checkbox" id="checkRazao"
                                    checked class="checkbox-dark"> Raz√£o Social</label>
                            <label class="flex items-center gap-2 cursor-pointer"><input type="checkbox"
                                    id="checkFantasia" checked class="checkbox-dark"> Fantasia</label>
                            <label class="flex items-center gap-2 cursor-pointer"><input type="checkbox" id="checkSocio"
                                    checked class="checkbox-dark"> Nome S√≥cio</label>
                        </div>
                    </div>

                    <!-- Tipo de Pesquisa -->
                    <div class="md:col-span-4">
                        <label class="block text-xs uppercase font-bold text-slate-400 mb-1">Tipo de Pesquisa</label>
                        <select id="tipoPesquisa" class="input-dark">
                            <option value="exata">Exata (Mais R√°pido)</option>
                            <option value="radical">Radical (Abrangente)</option>
                        </select>
                    </div>

                    <!-- CNPJ Especifico -->
                    <div class="md:col-span-8">
                        <label class="block text-xs uppercase font-bold text-slate-400 mb-1">CNPJ (Espec√≠fico ou
                            Lote)</label>
                        <div class="flex gap-2">
                            <input type="text" id="cnpj" placeholder="XX.XXX.XXX/XXXX-XX" class="input-dark">
                            <button type="button"
                                class="whitespace-nowrap px-4 bg-slate-700 hover:bg-slate-600 rounded text-xs font-bold text-white transition">INSERIR
                                LOTE</button>
                        </div>
                    </div>

                    <!-- CNPJ Raiz -->
                    <div class="md:col-span-4">
                        <label class="block text-xs uppercase font-bold text-slate-400 mb-1">CNPJ Raiz (8
                            D√≠gitos)</label>
                        <input type="text" id="cnpjRaiz" maxlength="8" placeholder="12345678" class="input-dark">
                    </div>
                </div>
            </div>

            <!-- 2. SITUA√á√ÉO E ATIVIDADE -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-slate-800/50 border border-slate-700 rounded-xl p-6 shadow-sm">
                    <h3 class="section-title"><i class="fa-solid fa-traffic-light"></i> Situa√ß√£o Cadastral</h3>
                    <div class="grid grid-cols-2 gap-3">
                        <label
                            class="flex items-center gap-2 cursor-pointer p-2 bg-slate-900 rounded border border-slate-700 hover:border-emerald-500 transition">
                            <input type="checkbox" id="sitAtiva" checked class="checkbox-dark text-emerald-500"> <span
                                class="text-white font-bold">ATIVA</span>
                        </label>
                        <label
                            class="flex items-center gap-2 cursor-pointer p-2 bg-slate-900 rounded border border-slate-700">
                            <input type="checkbox" id="sitBaixada" class="checkbox-dark text-red-500"> Baixada
                        </label>
                        <label
                            class="flex items-center gap-2 cursor-pointer p-2 bg-slate-900 rounded border border-slate-700">
                            <input type="checkbox" id="sitInapta" class="checkbox-dark"> Inapta
                        </label>
                        <label
                            class="flex items-center gap-2 cursor-pointer p-2 bg-slate-900 rounded border border-slate-700">
                            <input type="checkbox" id="sitSuspensa" class="checkbox-dark"> Suspensa
                        </label>
                    </div>
                </div>

                <div class="bg-slate-800/50 border border-slate-700 rounded-xl p-6 shadow-sm">
                    <h3 class="section-title"><i class="fa-solid fa-briefcase"></i> Atividade (CNAE)</h3>
                    <div class="space-y-3">
                        <input type="text" id="cnae" placeholder="C√≥digo ou nome da atividade..." class="input-dark">
                        <label class="flex items-center gap-2 cursor-pointer text-sm">
                            <div
                                class="relative inline-block w-10 h-5 align-middle select-none transition duration-200 ease-in">
                                <input type="checkbox" id="cnaeSecundaria"
                                    class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer border-slate-600" />
                                <label for="cnaeSecundaria"
                                    class="toggle-label block overflow-hidden h-5 rounded-full bg-slate-700 cursor-pointer"></label>
                            </div>
                            Incluir Atividade Secund√°ria
                        </label>
                    </div>
                    <div class="mt-4">
                        <label class="block text-xs uppercase font-bold text-slate-400 mb-1">Natureza Jur√≠dica</label>
                        <input type="text" id="naturezaJuridica" placeholder="Ex: EIRELI, MEI, LTDA..."
                            class="input-dark">
                    </div>
                </div>
            </div>

            <!-- 3. LOCALIZA√á√ÉO (GEO TARGETING) -->
            <div class="bg-slate-800/50 border border-slate-700 rounded-xl p-6 shadow-sm">
                <h3 class="section-title"><i class="fa-solid fa-map-location-dot"></i> Localiza√ß√£o (Sniper)</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="md:col-span-1">
                        <label class="block text-xs uppercase font-bold text-slate-400 mb-1">Estado (UF)</label>
                        <select id="uf" class="input-dark">
                            <option value="">Todos</option>
                            <option value="SP">SP - S√£o Paulo</option>
                            <option value="RJ">RJ - Rio de Janeiro</option>
                            <option value="MG">MG - Minas Gerais</option>
                            <option value="RS">RS - Rio Grande do Sul</option>
                            <option value="PR">PR - Paran√°</option>
                            <option value="SC">SC - Santa Catarina</option>
                            <option value="BA">BA - Bahia</option>
                            <!-- Adicionar outros se necess√°rio -->
                        </select>
                    </div>
                    <div class="md:col-span-1">
                        <label class="block text-xs uppercase font-bold text-slate-400 mb-1">Munic√≠pio</label>
                        <input type="text" id="municipio" placeholder="Digite a cidade" class="input-dark">
                    </div>
                    <div class="md:col-span-1">
                        <label class="block text-xs uppercase font-bold text-slate-400 mb-1">Bairro</label>
                        <input type="text" id="bairro" placeholder="Digite o bairro" class="input-dark">
                    </div>
                    <div class="md:col-span-1">
                        <label class="block text-xs uppercase font-bold text-slate-400 mb-1">CEP (8 d√≠gitos)</label>
                        <input type="text" id="cep" placeholder="00000000" maxlength="8" class="input-dark">
                    </div>
                </div>
            </div>

            <!-- 4. CONTATO E DADOS -->
            <div class="bg-slate-800/50 border border-slate-700 rounded-xl p-6 shadow-sm">
                <h3 class="section-title"><i class="fa-solid fa-address-book"></i> Contato Direto</h3>
                <div class="grid grid-cols-1 md:grid-cols-6 gap-4">
                    <div class="md:col-span-1">
                        <label class="block text-xs uppercase font-bold text-slate-400 mb-1">DDD</label>
                        <input type="text" id="ddd" placeholder="11" maxlength="2" class="input-dark text-center">
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-xs uppercase font-bold text-slate-400 mb-1">Telefone</label>
                        <input type="text" id="telefone" placeholder="XXXXXXXXX" class="input-dark">
                    </div>
                    <div class="md:col-span-3">
                        <div class="flex flex-col gap-2 mt-6">
                            <label class="flex items-center gap-2 cursor-pointer text-sm">
                                <input type="checkbox" id="comEmail" class="checkbox-dark"> Com E-mail
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer text-sm">
                                <input type="checkbox" id="soCelular" class="checkbox-dark"> Somente Celular
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 5. FILTROS AVAN√áADOS (O PESO PESADO) -->
            <div class="bg-slate-800/50 border border-slate-700 rounded-xl p-6 shadow-sm">
                <h3 class="section-title"><i class="fa-solid fa-sliders"></i> Filtros Avan√ßados (Switches)</h3>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">

                    <!-- BLOCO MEI -->
                    <div class="space-y-3 p-3 border border-slate-700 rounded bg-slate-900/30">
                        <span class="text-xs font-bold text-purple-400 uppercase">Regime MEI</span>

                        <div class="flex items-center justify-between">
                            <span class="text-sm">Somente MEI</span>
                            <div class="relative inline-block w-10 h-5 align-middle select-none">
                                <input type="checkbox" id="swOnlyMei"
                                    class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer border-slate-600" />
                                <label for="swOnlyMei"
                                    class="toggle-label block overflow-hidden h-5 rounded-full bg-slate-700 cursor-pointer"></label>
                            </div>
                        </div>

                        <div class="flex items-center justify-between">
                            <span class="text-sm">Excluir MEI</span>
                            <div class="relative inline-block w-10 h-5 align-middle select-none">
                                <input type="checkbox" id="swExcludeMei"
                                    class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer border-slate-600" />
                                <label for="swExcludeMei"
                                    class="toggle-label block overflow-hidden h-5 rounded-full bg-slate-700 cursor-pointer"></label>
                            </div>
                        </div>

                        <div class="border-t border-slate-700 pt-2 mt-2">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-sm text-slate-400">Exclu√≠das do MEI</span>
                                <div class="relative inline-block w-10 h-5 align-middle select-none">
                                    <input type="checkbox" id="swExcludedFromMei"
                                        class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer border-slate-600" />
                                    <label for="swExcludedFromMei"
                                        class="toggle-label block overflow-hidden h-5 rounded-full bg-slate-700 cursor-pointer"></label>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-2">
                                <input type="date" id="meiExcDe" class="input-dark text-xs p-1" placeholder="De">
                                <input type="date" id="meiExcAte" class="input-dark text-xs p-1" placeholder="At√©">
                            </div>
                        </div>
                    </div>

                    <!-- BLOCO SIMPLES -->
                    <div class="space-y-3 p-3 border border-slate-700 rounded bg-slate-900/30">
                        <span class="text-xs font-bold text-blue-400 uppercase">Simples Nacional</span>

                        <div class="flex items-center justify-between">
                            <span class="text-sm">Empresas do Simples</span>
                            <div class="relative inline-block w-10 h-5 align-middle select-none">
                                <input type="checkbox" id="swOnlySimples"
                                    class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer border-slate-600" />
                                <label for="swOnlySimples"
                                    class="toggle-label block overflow-hidden h-5 rounded-full bg-slate-700 cursor-pointer"></label>
                            </div>
                        </div>

                        <div class="flex items-center justify-between">
                            <span class="text-sm">Excluir Simples</span>
                            <div class="relative inline-block w-10 h-5 align-middle select-none">
                                <input type="checkbox" id="swExcludeSimples"
                                    class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer border-slate-600" />
                                <label for="swExcludeSimples"
                                    class="toggle-label block overflow-hidden h-5 rounded-full bg-slate-700 cursor-pointer"></label>
                            </div>
                        </div>

                        <div class="border-t border-slate-700 pt-2 mt-2">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-sm text-slate-400">Exclu√≠das do Simples</span>
                                <div class="relative inline-block w-10 h-5 align-middle select-none">
                                    <input type="checkbox" id="swExcludedFromSimples"
                                        class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer border-slate-600" />
                                    <label for="swExcludedFromSimples"
                                        class="toggle-label block overflow-hidden h-5 rounded-full bg-slate-700 cursor-pointer"></label>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-2">
                                <input type="date" id="simplesExcDe" class="input-dark text-xs p-1">
                                <input type="date" id="simplesExcAte" class="input-dark text-xs p-1">
                            </div>
                        </div>
                    </div>

                    <!-- BLOCO ESTRUTURA & OUTROS -->
                    <div class="space-y-3 p-3 border border-slate-700 rounded bg-slate-900/30">
                        <span class="text-xs font-bold text-yellow-400 uppercase">Estrutura & Filtros</span>

                        <div class="flex items-center justify-between">
                            <span class="text-sm">Somente Matriz</span>
                            <div class="relative inline-block w-10 h-5 align-middle select-none">
                                <input type="checkbox" id="swOnlyMatriz"
                                    class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer border-slate-600" />
                                <label for="swOnlyMatriz"
                                    class="toggle-label block overflow-hidden h-5 rounded-full bg-slate-700 cursor-pointer"></label>
                            </div>
                        </div>

                        <div class="flex items-center justify-between">
                            <span class="text-sm">Somente Filial</span>
                            <div class="relative inline-block w-10 h-5 align-middle select-none">
                                <input type="checkbox" id="swOnlyFilial"
                                    class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer border-slate-600" />
                                <label for="swOnlyFilial"
                                    class="toggle-label block overflow-hidden h-5 rounded-full bg-slate-700 cursor-pointer"></label>
                            </div>
                        </div>

                        <div class="flex items-center justify-between">
                            <span class="text-sm text-red-400">Excluir e-mail "Contab"</span>
                            <div class="relative inline-block w-10 h-5 align-middle select-none">
                                <input type="checkbox" id="swExcludeContab"
                                    class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer border-slate-600" />
                                <label for="swExcludeContab"
                                    class="toggle-label block overflow-hidden h-5 rounded-full bg-slate-700 cursor-pointer"></label>
                            </div>
                        </div>

                        <div class="flex items-center justify-between">
                            <span class="text-sm text-red-400">Excluir J√° Visualizadas</span>
                            <div class="relative inline-block w-10 h-5 align-middle select-none">
                                <input type="checkbox" id="swExcludeViewed"
                                    class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer border-slate-600" />
                                <label for="swExcludeViewed"
                                    class="toggle-label block overflow-hidden h-5 rounded-full bg-slate-700 cursor-pointer"></label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- DATAS E VALORES -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6 pt-6 border-t border-slate-700">
                    <div>
                        <label class="block text-xs uppercase font-bold text-slate-400 mb-2">Data de Abertura
                            (Range)</label>
                        <div class="flex items-center gap-2">
                            <input type="date" id="dataAberturaDe" class="input-dark">
                            <span class="text-slate-500">at√©</span>
                            <input type="date" id="dataAberturaAte" class="input-dark">
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs uppercase font-bold text-slate-400 mb-2">Capital Social (R$)</label>
                        <div class="flex items-center gap-2">
                            <input type="number" id="capitalMin" placeholder="M√≠nimo" class="input-dark">
                            <span class="text-slate-500">at√©</span>
                            <input type="number" id="capitalMax" placeholder="M√°ximo" class="input-dark">
                        </div>
                    </div>
                </div>
            </div>

            <!-- 6. INTEGRA√á√ÉO E WEBHOOKS (NOVO M√ìDULO) -->
            <div class="bg-slate-800/50 border border-slate-700 rounded-xl p-6 shadow-sm">
                <h3 class="section-title"><i class="fa-solid fa-satellite-dish"></i> Integra√ß√£o & Notifica√ß√µes
                    (Webhooks)</h3>

                <div class="space-y-4">
                    <!-- Nome do Webhook -->
                    <div>
                        <label class="block text-xs uppercase font-bold text-slate-400 mb-1">Nome para
                            Identifica√ß√£o</label>
                        <input type="text" id="webhookName" placeholder="Ex: Enviar para CRM, Notificar Zapier..."
                            class="input-dark">
                    </div>

                    <!-- URL do Webhook -->
                    <div>
                        <label class="block text-xs uppercase font-bold text-slate-400 mb-1">URL de Destino
                            (Endpoint)</label>
                        <input type="url" id="webhookUrl" placeholder="https://api.seusistema.com/webhook/..."
                            class="input-dark">
                    </div>

                    <!-- Token -->
                    <div>
                        <label class="block text-xs uppercase font-bold text-slate-400 mb-1">Token de Autentica√ß√£o
                            (Opcional)</label>
                        <input type="text" id="webhookToken" placeholder="Bearer Token ou API Key" class="input-dark">
                    </div>

                    <div
                        class="flex flex-col md:flex-row items-center justify-between gap-4 pt-4 border-t border-slate-700">
                        <!-- Event Type -->
                        <div class="flex items-center gap-3">
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="webhookEventNewCompany" checked class="checkbox-dark">
                                <span class="text-sm font-bold text-slate-300">Notificar Novas Empresas</span>
                            </label>
                        </div>

                        <!-- Ativa√ß√£o -->
                        <div class="flex items-center gap-3 bg-slate-900 p-3 rounded-lg border border-slate-700">
                            <span class="text-sm font-bold uppercase" id="webhookStatusLabel">Webhook Desativado</span>
                            <div class="relative inline-block w-12 h-6 align-middle select-none">
                                <input type="checkbox" id="webhookActive"
                                    class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer border-slate-600"
                                    onchange="toggleWebhookStatus()" />
                                <label for="webhookActive"
                                    class="toggle-label block overflow-hidden h-6 rounded-full bg-slate-700 cursor-pointer"></label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ACTION BUTTON -->
            <button id="btnHunt" type="submit"
                class="w-full bg-emerald-600 hover:bg-emerald-500 text-white font-black py-5 rounded-xl shadow-lg shadow-emerald-500/20 transform hover:-translate-y-1 transition duration-200 flex items-center justify-center gap-3 text-2xl group">
                <span>EXECUTAR MINERA√á√ÉO V4.3</span>
                <i class="fa-solid fa-rocket group-hover:animate-bounce"></i>
            </button>

            <!-- üìä PAINEL DE TELEMETRIA -->
            <div id="resultsPanel" class="hidden grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
                <!-- Card 1: Encontradas -->
                <div
                    class="result-card bg-slate-800 border border-slate-700 rounded-xl p-4 flex flex-col items-center justify-center">
                    <span class="text-xs uppercase text-slate-400 font-bold mb-1">Empresas Capturadas</span>
                    <span id="resTotal" class="text-4xl font-black text-emerald-400">---</span>
                </div>
                <!-- Card 2: Status -->
                <div class="result-card bg-slate-800 border border-slate-700 rounded-xl p-4 flex flex-col items-center justify-center"
                    style="animation-delay: 0.1s">
                    <span class="text-xs uppercase text-slate-400 font-bold mb-1">Status da Miss√£o</span>
                    <span id="resStatus" class="text-lg font-bold text-blue-400 text-center">Aguardando...</span>
                </div>
                <!-- Card 3: Link -->
                <div class="result-card bg-slate-800 border border-slate-700 rounded-xl p-4 flex flex-col items-center justify-center"
                    style="animation-delay: 0.2s">
                    <span class="text-xs uppercase text-slate-400 font-bold mb-1">Destino</span>
                    <a id="resLink" href="#" target="_blank"
                        class="text-sm text-purple-400 hover:text-purple-300 underline font-mono flex items-center gap-2">
                        Ver no Kestra <i class="fa-solid fa-external-link-alt"></i>
                    </a>
                </div>
            </div>

        </form>

        <!-- CONSOLE -->
        <div class="bg-black border border-slate-800 rounded-xl p-4 font-mono text-sm h-48 overflow-y-auto shadow-inner"
            id="consoleOutput">
            <div class="text-emerald-500 mb-2">> System Ready. V4.4 Loaded.</div>
        </div>

    </main>

    <script>
        // CONFIG
        const DEFAULT_CONFIG = {
            url: "https://kestra.biotchellyprospecta.online",
            namespace: "biotchellymcp",
            flowId: "06cacador_de_leads"
        };

        // LOGGER
        const log = (msg, type = 'info') => {
            const consoleDiv = document.getElementById('consoleOutput');
            const p = document.createElement('div');
            const color = type === 'error' ? 'text-red-400' : (type === 'success' ? 'text-emerald-400' : 'text-slate-400');
            p.className = `${color} mb-1`;
            p.innerHTML = `> ${msg}`;
            consoleDiv.appendChild(p);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        };

        // THEME MANAGER
        function toggleTheme() {
            const html = document.documentElement;
            const btn = document.getElementById('themeBtn');
            const icon = btn.querySelector('i');

            html.classList.toggle('light-mode');

            const isLight = html.classList.contains('light-mode');

            // Visual Update
            if (isLight) {
                icon.className = 'fa-solid fa-moon';
                btn.classList.replace('text-yellow-400', 'text-slate-600');
            } else {
                icon.className = 'fa-solid fa-sun';
                btn.classList.replace('text-slate-600', 'text-yellow-400');
            }

            // Persistence
            localStorage.setItem('biotchelly_theme', isLight ? 'light' : 'dark');
            log(`Tema alterado para: ${isLight ? 'Claro ‚òÄÔ∏è' : 'Escuro üåë'}`, "system");
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('biotchelly_theme');
            if (savedTheme === 'light') {
                toggleTheme(); // Apply light mode if saved
            }
        }

        // WEBHOOK UI LOGIC
        function toggleWebhookStatus() {
            const isActive = document.getElementById('webhookActive').checked;
            const label = document.getElementById('webhookStatusLabel');
            if (isActive) {
                label.innerText = "Webhook Ativado";
                label.classList.add("text-emerald-400");
                label.classList.remove("text-slate-400");
            } else {
                label.innerText = "Webhook Desativado";
                label.classList.add("text-slate-400");
                label.classList.remove("text-emerald-400");
            }
        }

        // CONFIG MANAGER
        function loadConfig() {
            const saved = JSON.parse(localStorage.getItem('biotchelly_config') || '{}');
            document.getElementById('kestraUrl').value = saved.url || DEFAULT_CONFIG.url;
            document.getElementById('kestraNamespace').value = saved.namespace || DEFAULT_CONFIG.namespace;
            document.getElementById('kestraFlowId').value = saved.flowId || DEFAULT_CONFIG.flowId;
            document.getElementById('apiTokenCasaDados').value = saved.apiTokenCasaDados || '';
            return { ...DEFAULT_CONFIG, ...saved };
        }

        function saveConfig() {
            const config = {
                url: document.getElementById('kestraUrl').value.replace(/\/$/, ""),
                namespace: document.getElementById('kestraNamespace').value,
                flowId: document.getElementById('kestraFlowId').value,
                apiTokenCasaDados: document.getElementById('apiTokenCasaDados').value
            };
            localStorage.setItem('biotchelly_config', JSON.stringify(config));
            toggleConfig();
            log("Configura√ß√µes salvas.");
        }

        function toggleConfig() {
            document.getElementById('configModal').classList.toggle('hidden');
        }

        function clearForm() {
            document.getElementById("hunterForm").reset();
            document.getElementById("resultsPanel").classList.add("hidden");
            toggleWebhookStatus(); // Reset label color
            log("Formul√°rio limpo.");
        }

        // Atualiza a UI dos resultados
        function updateResults(total, status, link, colorClass = "text-emerald-400") {
            const panel = document.getElementById("resultsPanel");
            panel.classList.remove("hidden");

            const totalEl = document.getElementById("resTotal");
            totalEl.innerText = total;
            totalEl.className = `text-4xl font-black ${colorClass}`;

            document.getElementById("resStatus").innerText = status;
            document.getElementById("resLink").href = link;
        }

        // MAIN EXECUTION
        async function startHunt() {
            const config = loadConfig();
            const btn = document.getElementById('btnHunt');

            // COLETANDO TODOS OS DADOS (MAPPING COMPLETO DOS PRINTS)
            const filters = {
                // Identifica√ß√£o
                termo: document.getElementById('termo').value,
                checks: {
                    razao: document.getElementById('checkRazao').checked,
                    fantasia: document.getElementById('checkFantasia').checked,
                    socio: document.getElementById('checkSocio').checked
                },
                tipoPesquisa: document.getElementById('tipoPesquisa').value,
                cnpj: document.getElementById('cnpj').value,
                cnpjRaiz: document.getElementById('cnpjRaiz').value,

                // Situa√ß√£o
                situacao: {
                    ativa: document.getElementById('sitAtiva').checked,
                    baixada: document.getElementById('sitBaixada').checked,
                    inapta: document.getElementById('sitInapta').checked,
                    suspensa: document.getElementById('sitSuspensa').checked
                },

                // Atividade
                cnae: document.getElementById('cnae').value,
                cnaeSecundaria: document.getElementById('cnaeSecundaria').checked,
                naturezaJuridica: document.getElementById('naturezaJuridica').value,

                // Localiza√ß√£o
                uf: document.getElementById('uf').value,
                municipio: document.getElementById('municipio').value,
                bairro: document.getElementById('bairro').value,
                cep: document.getElementById('cep').value,

                // Contato
                ddd: document.getElementById('ddd').value,
                telefone: document.getElementById('telefone').value,
                comEmail: document.getElementById('comEmail').checked,
                soCelular: document.getElementById('soCelular').checked,

                // Avan√ßados (Switches)
                mei: {
                    only: document.getElementById('swOnlyMei').checked,
                    exclude: document.getElementById('swExcludeMei').checked,
                    excludedHistory: document.getElementById('swExcludedFromMei').checked,
                    rangeDe: document.getElementById('meiExcDe').value,
                    rangeAte: document.getElementById('meiExcAte').value
                },
                simples: {
                    only: document.getElementById('swOnlySimples').checked,
                    exclude: document.getElementById('swExcludeSimples').checked,
                    excludedHistory: document.getElementById('swExcludedFromSimples').checked,
                    rangeDe: document.getElementById('simplesExcDe').value,
                    rangeAte: document.getElementById('simplesExcAte').value
                },
                estrutura: {
                    onlyMatriz: document.getElementById('swOnlyMatriz').checked,
                    onlyFilial: document.getElementById('swOnlyFilial').checked
                },
                filtrosEspeciais: {
                    excludeContab: document.getElementById('swExcludeContab').checked,
                    excludeViewed: document.getElementById('swExcludeViewed').checked
                },

                // Datas e Valores
                abertura: {
                    de: document.getElementById('dataAberturaDe').value,
                    ate: document.getElementById('dataAberturaAte').value
                },
                capital: {
                    min: document.getElementById('capitalMin').value,
                    max: document.getElementById('capitalMax').value
                },

                // üì° WEBHOOKS (NOVO)
                webhook: {
                    active: document.getElementById('webhookActive').checked,
                    name: document.getElementById('webhookName').value,
                    url: document.getElementById('webhookUrl').value,
                    token: document.getElementById('webhookToken').value,
                    events: {
                        newCompany: document.getElementById('webhookEventNewCompany').checked
                    }
                }
            };

            log("Empacotando payload V4.4...", "info");
            console.log(filters);

            // UI Loading
            btn.disabled = true;
            btn.innerHTML = `<i class="fa-solid fa-circle-notch fa-spin"></i> CA√áANDO... (AGUARDE)`;

            // Reseta o painel visual
            document.getElementById("resultsPanel").classList.add("hidden");

            const formData = new FormData();
            formData.append('filters_json', JSON.stringify(filters));
            formData.append('termo', filters.termo);
            formData.append('estado', filters.uf);
            // Novo campo de token
            formData.append('casa_dados_token', config.apiTokenCasaDados || '');

            // ‚ö†Ô∏è ?wait=true para esperar o retorno real da contagem
            const endpoint = `${config.url}/api/v1/executions/${config.namespace}/${config.flowId}?wait=true`;

            try {
                const response = await fetch(endpoint, { method: 'POST', body: formData });

                if (response.ok) {
                    const data = await response.json();
                    const link = `${config.url}/ui/executions/${config.namespace}/${config.flowId}/${data.id}`;

                    log(`SUCESSO! Execu√ß√£o finalizada (ID: ${data.id})`, "success");

                    // Tenta extrair outputs se existirem
                    let countDisplay = "N/D";
                    let statusDisplay = "Finalizado";

                    if (data.outputs && data.outputs.count) {
                        countDisplay = data.outputs.count;
                        statusDisplay = "Sucesso Total";
                        log(`Relat√≥rio: ${countDisplay} empresas encontradas.`, "success");
                    } else {
                        // Se o fluxo n√£o tiver output configurado, mostra aviso
                        countDisplay = "?";
                        statusDisplay = "Ver NocoDB";
                        log("Aviso: O fluxo executou, mas n√£o retornou a contagem (verifique se 'outputs' est√° configurado no YAML).", "warn");
                    }

                    updateResults(countDisplay, statusDisplay, link);

                } else {
                    const err = await response.text();
                    log(`Erro no disparo: ${err}`, "error");
                    updateResults("ERRO", "Falha API", "#", "text-red-500");
                }
            } catch (error) {
                log(`Falha de conex√£o: ${error.message}`, "error");
                updateResults("OFF", "Sem Conex√£o", "#", "text-red-500");
            } finally {
                btn.disabled = false;
                btn.innerHTML = `<span>EXECUTAR MINERA√á√ÉO V4.3</span><i class="fa-solid fa-rocket"></i>`;
            }
        }

        window.onload = () => {
            loadConfig();
            loadTheme();
            toggleWebhookStatus(); // Init label state
            log("Painel V4.4 Iniciado. Aguardando comando.");
        };
    </script>
</body>

</html>
